---
sudo: required
dist: bionic

notifications:
  slack:
    on_failure: always

matrix:
  fast_finish: true
  include:

    - name: "blue green minikube latest  on bionic amd64" #OK
      dist: bionic         
      arch: amd64
      language: cpp
      # Coverity Scan
      env:
        global:
        # The next declaration is the encrypted COVERITY_SCAN_TOKEN, created
        #   via the "travis encrypt" command using the project repo's public key
        - secure: $COVERITY_SCAN_TOKEN   
      # Coverity Scan
      addons:
        coverity_scan:
          project:
            name: "githubfoam/blue-green-sandbox"
            description: "Build submitted via Travis CI"
          notification_email: $COVERITY_SCAN_NOTIFICATION_EMAIL
          build_command_prepend: "./configure; make clean"
          build_command:   "make -j 4"
          branch_pattern: coverity_scan       
      # before_install:
      #   - pip3 install virtualenv
      #   - virtualenv -p $(which python3) ~venvpy3
      #   - source ~venvpy3/bin/activate
      #   - pip install -r requirements.txt
      script:
        - sudo make deploy-minikube-latest
        - sudo make deploy-bluegreen
      after_success:
        - bash <(curl -s https://codecov.io/bash) #codecov.io
        - deactivate